# Plan: F-001 - Create Cart Context with localStorage

## Feature Context
**ID**: F-001
**Title**: Create Cart Context with localStorage
**Description**: Implement cart state management using React Context with localStorage persistence.
**Priority**: 1
**Blocked By**: None

## Acceptance Criteria
- [ ] CartContext created in src/lib/cart.tsx
- [ ] addToCart, removeFromCart, clearCart functions
- [ ] Cart persists across page refreshes
- [ ] npm run build passes

---

## MANDATORY READING

**BEFORE implementing, READ these files:**
- `src/lib/currency.tsx` - Pattern for React Context
- `src/types/index.ts` - Existing type definitions
- `.claude/rules/ralph.md` - Project patterns

---

## PATTERNS TO MIRROR

### Pattern 1: Context Provider
**Source**: `src/lib/currency.tsx:1-50`
```typescript
'use client';

import { createContext, useContext, useState, ReactNode } from 'react';

interface ContextType { /* ... */ }

const MyContext = createContext<ContextType | undefined>(undefined);

export function MyProvider({ children }: { children: ReactNode }) {
  const [state, setState] = useState(initialValue);
  return (
    <MyContext.Provider value={{ state, setState }}>
      {children}
    </MyContext.Provider>
  );
}

export function useMyContext() {
  const context = useContext(MyContext);
  if (!context) throw new Error('Must be within Provider');
  return context;
}
```

---

## FILES TO CHANGE

### New Files
- `src/lib/cart.tsx` - Cart context and provider (max 150 lines)

### Modified Files
- `src/app/[locale]/layout.tsx` - Wrap with CartProvider

---

## STEP-BY-STEP TASKS

### Task 1: Create CartItem Type
**IMPLEMENT**: Define CartItem interface
**PATTERN**: Mirror existing types in src/types/index.ts
**MAX LINES**: 10
**VALIDATE**: `npm run build`

```typescript
interface CartItem {
  productId: string;
  slug: string;
  title: string;
  priceEur: number;
  quantity: number;
  image?: string;
}
```

### Task 2: Create Cart Context
**IMPLEMENT**: Create context with localStorage persistence
**PATTERN**: Mirror `src/lib/currency.tsx` structure
**MAX LINES**: 100
**VALIDATE**: `npm run build`

Key functions:
- `addToCart(item: CartItem)`
- `removeFromCart(productId: string)`
- `updateQuantity(productId: string, quantity: number)`
- `clearCart()`
- `getCartTotal(): number`

### Task 3: Add localStorage Persistence
**IMPLEMENT**: Save/load cart from localStorage
**MAX LINES**: 30
**VALIDATE**: `npm run build`

Use useEffect to:
- Load cart from localStorage on mount
- Save cart to localStorage on change

### Task 4: Add CartProvider to Layout
**IMPLEMENT**: Wrap app with CartProvider
**PATTERN**: Mirror CurrencyProvider in layout
**VALIDATE**: `npm run build`

---

## VALIDATION COMMANDS

```bash
npm run build   # Must pass
```

---

## CODE CONSTRAINTS

- [ ] File < 500 lines (target: ~120 lines)
- [ ] Each function < 50 lines
- [ ] Uses existing Context pattern
- [ ] No duplicate code
- [ ] localStorage key: 'sawei-cart'

---

## COMPLETION CHECKLIST

- [ ] CartItem type defined
- [ ] CartContext created
- [ ] useCart hook exported
- [ ] localStorage persistence works
- [ ] CartProvider added to layout
- [ ] npm run build passes
